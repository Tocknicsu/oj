#!/bin/sh
ls -alS|awk '/^d/{printf"1\t"}/^-/{printf"2\t"}/^[d-]/{c=sprintf("du -s %s",$9);system(c);}'|awk 'BEGIN{l=0}{a[l,1]=$1;a[l,2]=$2;a[l,3]=$3;l++}function swap(i,j){for(x=1;x<4;++x){t=a[i,x];a[i,x]=a[j,x];a[j,x]=t}}function h(i){printf"\t";if(i>=999*1024){if(i>=10*1048576)printf"%dG",i/1048576;else printf "%.1fG",i/1048576;}else if(i>999){if(i>=10*1024)printf"%dM",i/1024;else printf "%.1fM",i/1024;}else if(i==0){printf"0B"}else{if(i>=10)printf"%dK",i;else printf "%.1fK",i}printf"\t"}function p(i){h(a[i,2]);print a[i,3]}END{for(i=0;i<l;++i)for(j=0;j<l;++j){if(a[i,1]<a[j,1]){swap(i,j);}else if(a[i,1]==a[j,1]&&a[i,2]>a[j,2]){swap(i,j)}else if(a[i,1]==a[j,1]&&a[i,2]==a[j,2]&&a[i,3]<a[j,3]){swap(i,j)}};a[1,3]="total";print"directory:";for(i=2;i<l;++i)if(a[i,1]==1)p(i);print"file:";for(i=2;i<l;++i)if(a[i,1]==2)p(i);print"total:";p(1)}'
